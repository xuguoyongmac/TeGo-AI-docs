---
import DocLayout from '../../layouts/DocLayout.astro';
import { readFileSync } from 'fs';
import { marked } from 'marked';

// 读取Markdown内容
const markdownContent = readFileSync('./src/content/architecture.md', 'utf-8');

// 预处理内容，将 {#id} 格式转换为标准格式
const processedContent = markdownContent.replace(/\{#([^}]+)\}/g, ' {#$1}');
let htmlContent = marked(processedContent) as string; // Cast to string for replace method

// 手动添加ID到标题元素
htmlContent = htmlContent.replace(
  /<h([1-6])>([^<]*)\s*\{#([^}]+)\}<\/h([1-6])>/g,
  '<h$1 id="$3">$2</h$1>'
);

// 侧边栏配置
const sidebarItems = [
  { href: '#overview', text: '概述' },
  { href: '#architecture', text: '整体架构' },
  { href: '#tech-stack', text: '核心技术栈' },
  { href: '#components', text: '系统组件' },
  { href: '#data-architecture', text: '数据架构' },
  { href: '#security', text: '安全架构' },
  { href: '#deployment', text: '部署架构' },
  { href: '#performance', text: '性能优化' },
  { href: '#scalability', text: '扩展性设计' },
  { href: '#devops', text: '开发运维' },
  { href: '#best-practices', text: '最佳实践' }
];

// 面包屑配置
const breadcrumbs = [
  { href: '/', text: '首页' },
  { href: '/product-intro', text: '产品介绍' },
  { text: '技术架构' }
];
---

<DocLayout 
  title="TeGo-AI 技术架构"
  description="TeGo-AI 的技术架构详解，包括微服务架构、核心技术栈、系统组件等"
  sidebarTitle="目录"
  sidebarItems={sidebarItems}
  breadcrumbs={breadcrumbs}
>
  <div set:html={htmlContent} />
  
  <div slot="navigation">
    <a href="/product-intro" class="nav-link">← 返回产品介绍</a>
    <a href="/product-intro/features" class="nav-link">核心功能 →</a>
  </div>
</DocLayout>