---
import DocLayout from '../../layouts/DocLayout.astro';
import { readFileSync } from 'fs';
import { marked } from 'marked';

// 读取Markdown内容
const markdownContent = readFileSync('./src/content/features.md', 'utf-8');

// 预处理内容，将 {#id} 格式转换为标准格式
const processedContent = markdownContent.replace(/\{#([^}]+)\}/g, ' {#$1}');
let htmlContent = marked(processedContent) as string; // Cast to string for replace method

// 手动添加ID到标题元素
htmlContent = htmlContent.replace(
  /<h([1-6])>([^<]*)\s*\{#([^}]+)\}<\/h([1-6])>/g,
  '<h$1 id="$3">$2</h$1>'
);

// 侧边栏配置
const sidebarItems = [
  { href: '#overview', text: '概述' },
  { href: '#smart-instance', text: '智能实例管理' },
  { href: '#service-discovery', text: '服务动态发现' },
  { href: '#mcp-generation', text: 'MCP服务生成' },
  { href: '#runtime-ui', text: '运行时UI生成' },
  { href: '#llm-gateway', text: 'LLM网关' },
  { href: '#workflow-engine', text: '流程引擎' },
  { href: '#data-bus', text: '数据总线' }
];

// 面包屑配置
const breadcrumbs = [
  { href: '/', text: '首页' },
  { href: '/product-intro', text: '产品介绍' },
  { text: '核心功能' }
];
---

<DocLayout 
  title="TeGo-AI 核心功能"
  description="TeGo-AI 智能体管理平台的核心功能详解，包括智能实例管理、服务动态发现、MCP服务生成等"
  sidebarTitle="目录"
  sidebarItems={sidebarItems}
  breadcrumbs={breadcrumbs}
>
  <div set:html={htmlContent} />
  
  <div slot="navigation">
    <a href="/product-intro" class="nav-link">← 返回产品介绍</a>
    <a href="/product-intro/architecture" class="nav-link">技术架构 →</a>
  </div>
</DocLayout>